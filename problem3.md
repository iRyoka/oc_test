## Классификация клеток ##

*Увы, мне не хватило времени даже на proof of concept, тем не менее мне показалось небесполезным изложить мои мысли
на тему того, как бы я пробовал эту задачу решать.*

Краткое изучение литературы показало, что в задаче segmentation and classification гистологических изображений 
нейросетевой подход вытесняет эвристические алгоритмы практически полностью. При этом наблюдается разнообразие 
подходов (вероятно, продиктованное актуальностью задачи). Стоит выделить как минимум две нейросетевые 
архитектуры, решающих задачу практически end-to-end

 - R-CNN [arXiv:1311.2524](https://arxiv.org/abs/1311.2524.pdf) и последующие fast R-CNN и faster R-CNN, в которых 
selective search был замене на сверточную реализацию поиска областей интереса. Ну и логическое завершение (на текущий момент) в иде Mask R-CNN.

 - авторы недавней работы [arXiv:2108.04614](https://arxiv.org/abs/2108.04614) протестировали YOLOv3 (полностью сверточная сеть, 
использует фиксированную сетку для поиска центров объектов и предсказания BB и класса) в задаче классификации лейкоцитов 
N.B.: ранее в литературе можно заметить скептицизм по отношению к классификации клеток при помощи YOLO в связи с ее 
ограниченной способностью классификации малых объектов. Авторы указанной работы решают эту проблему достаточно цинично, выбором масштаба, что налагает определенные требования на качество входных изображений."

 - Также встречаются решения на основе генеративных сетей, e.g. 
[https://sci-hub.yncjkj.com/10.1109/cvpr.2018.00933](https://sci-hub.yncjkj.com/10.1109/cvpr.2018.00933), но я не берусь 
их комментировать, т.к. не усею подтянуть матчасть за ограниченное время (с GAN'ами я не сталкивался, равно как с и диффузионными сетями)

Так как все упомянутые сети достаточно глубокие сеть, натренировать их я бы не смог. Кроме того, YOLO, вообще говоря, 
требует bounding boxes в метках тренировочного набора. В боевой ситуации имеющиеся данные можно попробовать переразметить.
Авторы [2108:04614], увы не то что весами, но даже и репозиторием не поделились (учитывая, что вышла она осенью '21 года, 
вероятно, еще поделятся). Аналогично, самая оптимистичная оценка (увы, без указания конфига) на тренировку 
faster R-CNN в аналогичной ситуации, которую удалось найти -- 8 часов. На домашней 1050@2GB это утопичная задача.

Поэтому разумной кажется идея разделить задачу сегментации и классификации. Первую постараться решить эвристически, 
а для второй натренировать маленькую классифицирующую нейросеть сеть (ну, какая-нибудь VGG вполне справится); данной 
сети на вход можно подавать фиксированный ROI вокруг найденного центроида. Такого рода подход вполне успешно опробован 
в статье 19 года [BCMB19](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3850979/). Впрочем, они существенно используют 
доступ к микроскопам во время сканирования: им удается достигнуть появления гало вокруг индивидуальных клеток, 
на что они в существенной мере полагаются при их разделении. Вкратце, дальнейший алгоритм выглядит так: 
объекты переднего плана выделяются при помощи MSER [IVC2004](https://www.sciencedirect.com/science/article/abs/pii/S0262885604000435) 
ссылаясь на то, что он существенно более устойчив к изменениям освещенности внутри одного изображения, 
нежели методы, основанные на определении пограничных значений в цветовом пространстве. 
Также MSER допускает реализацию линейной сложности [EECV08](https://dl.acm.org/doi/10.1007/978-3-540-88688-4_14). 
Далее, авторы используют эрозию (для поиска центов) и watershedding (в силу стандартности алгоритма привожу 
ссылку на opencv реализацию [opencv.org](https://docs.opencv.org/4.x/d3/db4/tutorial_py_watershed.html)) 
для определения границ разделенных клеток. Последним шагом, самые маленькие образовавшиеся фрагменты считаются 
ошибочно отделенными и присоединяются к ближайшей крупной области. Я не увидел точного описания этого шага в статье, 
но как вариант можно детектировать все объекты малого размера и все границы бОльших объектов и для каждого маленького
найти ближайший большой; или просто применить к малым объектам раздутие и наложить на исходное 
изображение. Впрочем, в нашей задаче, вероятно, можно просто проигнорировать эти малые фрагменты, т.к. а) у нас объект -- это клетка, что-то сильно меньшее клетки нам не интересно 
б) скорее всего мы не сможем построить точный bounding bpx и будем скармливать классификатору какой-то предопределенный bounding box вокруг найденного центроида..
